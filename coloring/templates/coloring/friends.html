{% load static %}

<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Final Project: Implementation Prototype - Food Waste</title>
	<script type="text/javascript" src="{% static 'coloring/vendors/jquery/jquery-3.3.1.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'coloring/vendors/paper/paper-full.min.js' %}"></script>
  <link href="{% static 'coloring/vendors/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Shrikhand&display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;1,500&family=Shrikhand&display=swap" rel="stylesheet">
 

  
<!--   <link rel="stylesheet" href="coloring/templates/coloring/styles.css"> -->
  
  
  <style type="text/css">
    body {
      background-color: white;
    }
    
    #title {
      color: white;
      font-size: 44px;
      font-family: 'Shrikhand', cursive;
    }

    #nav-items {
      color: white;
      font-size: 24px;
      font-family: 'Lora', serif;
    }

    #list-text {
      color: blue;
      font-size: 35px;
      background-color: pink;
      border-radius: 25px;
    }
    
    #myCanvas {
      border: 1px solid black;
    }
    
  </style>
  
</head>
<body>


<nav class="navbar navbar-expand-md navbar-light " style="background-color: #3e8369;">
 
    <div class="mx-auto order-0">
        <a id="title" class="navbar-brand mx-auto" href="../">Wasteless</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".dual-collapse2">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
    <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a id="nav-items" class="nav-link" href="../">Home&nbsp&nbsp&nbsp&nbsp</a>
            </li>
            <li class="nav-item">
                <a id="nav-items" class="nav-link" href="../profile/">Profile&nbsp&nbsp&nbsp&nbsp</a>
            </li>
          <li class="nav-item">
                <a id="nav-items" class="nav-link" href="">Friends&nbsp&nbsp&nbsp&nbsp</a>
            </li>
           <li class="nav-item">
                <a id="nav-items" class="nav-link" href="../newlisting/">New Listing</a>
            </li>
        </ul>
    </div>
</nav>

  <h1>Friends of @<span id="username">{{ user.username }}</span></h1>
  <input type="text" id="friend" name="username">
  <button class="btn btn-large" style="background-color: #3e8369;" id="add">Add Friend</button>
  <h2 id="friend-list">Friends: </h2>
  <ul id="dynamic-list" style="list-style: none;"></ul>
  


  <script>

    const all_rows = document.querySelector(".row");
    function createRow(text){
      var ul = document.getElementById("dynamic-list");
      var li = document.createElement("li");
      li.setAttribute('id', 'list-text');
      li.setAttribute('class', 'p-3');
      li.appendChild(document.createTextNode('@'+ text));
      ul.appendChild(li);
      // let code = `<div class="col-md-1 m-2 shadow p-3 mb-5 bg-white rounded ">${text}</div>`;
      // all_rows.innerHTML += code;
    }
    

  function getFriends(friends_list){
    console.log(friends_list);
    for (var i = 0; i < friends_list.length; i++){
      var friend_name = friends_list[i];
      console.log("DEBUG: getFriends: friend name", friend_name);

      createRow(friend_name);
  }
    // //console.log(parseJSON(friends_list));
    //  for (var key in friends_list) {
    //      console.log("testing");
    //      console.log(key + " -> " + friends_list[key]); 
    //      const element = document.getElementById("row");
    // const node = document.createTextNode(friends_list[key]);
    // element.appendChild(node);
  }
   
  
  window.onload = function() {
    console.log({{ user.friends|safe }});
    var friends_list = {{ user.friends|safe }};
    
    
    $("#add").on("click", function(){
         
         
         var data_to_send = {
              "friends": $("#friend").val()
            };
         console.log("DEBUG: friends POST req data", data_to_send);
         $.ajax({
          type: "POST",
          url: "/wasteless/" + $('#username').text() + "/friends/",
          data: JSON.stringify(data_to_send),
          success: function (response) {
            // prints the response from the server
            console.log(response); 
          }
        });
    });

         function init(){
        
        getFriends(friends_list);
   
      }

      init();
  }

  //TODO: populate page with list of current friends
  //TODO: verify that the friend exists when 'add friend clicked', prompt error if not
  //TODO: create a post request to send data (new friend) to server

</script>
</body>
</html>